# 0516 URL, TCP, UDP

CS study #2



# 브라우저에 URL을 입력했을 때 발생하는 일들

> `8단계`
>
> 1. 브라우저의 URL 파싱
> 2. HSTS 목록 조회
> 3. URL을 IP 주소로 변환
> 4. 라우터를 통해 해당 서버의 게이트웨이까지 이동
> 5. ARP를 통해 IP주소를 MAC 주소로 변환
> 6. 대상 서버와 TCP 소켓 연결
> 7. HTTP(HTTPS) 프로토콜로 요청, 응답
> 8. 브라우저에서 응답을 해석



<br>

<br>

#### 

#### `1. 브라우저의 URL 파싱`

>  URL 입력받은 브라우저는 우선 URL 구조를 해석
>
> - 어떤 프로토콜로 어떤 도메인으로 어떤 포트로 보낼지 **URL 해석**
>
> - 기본 URL 구조는 다음과 같음
>
>   **`https` ://`www.daum.net` : `443`**
>
>   **protocol** + **URL** + **Port**
>
> - 만약, 명시적으로 프로토콜이나 포트를 입력하지 않으면 기본값(default)을 이용해 요청
>
>   (HTTP : 80 port,  HTTPS : 443 port)

<br>

#### 

#### `2. HSTS 목록 조회`

> HTTPS를 사용하는 연결만 허용하기 위해 브라우저의 HSTS캐시에 저장된 URL 목록
>
> - **HSTS(HTTP Strict transport security)**
> - 수행 단계
>   - 사용자가 주소창에 URL 작성 -> URL 구조 해석(위의 1단계)
>   - 만약 HTTP요청이라면?
>     - HTTP 응답 **헤더**에 **Strict transport security 필드**를 붙여서 응답
>     - 이 필드를 확인한 브라우저가 해당 서버에 요청할 때 HTTPS만을 통해 통신
>     - 브라우저가 자신의 HSTS 캐시에 해당 URL 저장 -> 이 저장한 URL 목록을 **HSTS 목록**
>   - 이 후 같은 URL로 요청 보낼 때
>     - 만약 HTTP 요청이라면?
>     - 해당 URL이 HSTS 목록에 있는지 조회
>     - 있으면 HTTPS로 요청보냄

<br>

#### 

#### `3. URL을 IP주소로 변환`

> URL을 컴퓨터가 통신할 수 있는 IP주소로 변환해야 함
>
> - 만약 URL이 localhost 파일과 브라우저 캐시에 있는지 확인
> - 없다면?
>   - 도메인 주소를 IP주소로 변환해주는 DNS 서버에 요청
>   - URL을 IP주소로 변환
> - 있다면?
>   - 바로 응답

<br>

#### 

#### `4. 라우터를 통해 해당 서버의 게이트웨이까지 이동`

> 네트워크 장비인 라우터를 통해 해당 IP주소로 가는 경로를 알 수 있음
>
> - 라우터 테이블을 통해 해당 요청이 어떤 경로로 가야하는지 경로를 지정해줌

<br>

#### 

#### `5. ARP를 통해 IP주소를 MAC주소로 변환`

> 실질적인 통신을 위해 논리주소인 IP주소를 물리주소인 MAC주소로 변환
>
> - 해당 네트워크 내에서 ARP를 브로드캐스팅
> - 해당 IP주소를 갖고 있는 노드는 자신의 MAC주소를 응답



<br>

#### `6. 대상 서버와 TCP 소켓 연결`

> 대상 서버와 통신하기 위해 TCP 소켓 연결을 진행
>
> - TCP의 **3-way-handshake**
>
>   - TCP가 장치들 사이에서 논리적인 접속을 성립하기 위해 사용
>
>   - TCP/IP 프로토콜을 이용해 통신을 하는 응용프로그램이 신뢰성있는 **데이터를 전송하기 전**에,
>
>     먼저 **정확한 전송을 보장**하기 위해 **상대방 컴퓨터와 사전에 세션을 수립**하는 과정을 의미
>
>   - 데이터를 전송하고 응답을 받음으로써 데이터가 올바로 전송되었는지 보장
>
>     만약 응답이 오지 않은 경우, 데이터가 손상되었다고 판단하고 해당 데이터 재전송
>
>   - 과정
>
>     > `Client > Server : TCP SYN  (서버 접속 요청)`
>     >
>     > - 클라이언트(브라우저)는 서버에 접속을 요청하는 **SYN 패킷**을 보냄
>     > - 패킷을 보낸 후, 클라이언트는 응답 대기 상태가 됨
>     >
>     > `Server > Client : TCP SYN ACK  (ACK 요청수락 응답대기)`
>     >
>     > - 서버가 SYN 요청을 받은 후, 클라이언트에게 요청을 수락한다는 **ACK + SYN** 플래그가 설정된 패킷을 발송
>     > - 다시 클라이언트가 응답하기를 기다림
>     >
>     > `Client > Server : TCP ACK  (ACK 응답 후 연결)`
>     >
>     > - 클라이언트에게 **ACK**를 보낸 후부터 연결이 이루어짐
>     > - 이 후 데이터가 오갈 수 있게 됨
>
> - 위의 절차는 TCP 접속을 성공적으로 성립하기 위하여 반드시 필요



<br>

#### `7. HTTP(HTTPS) 프로토콜로 요청, 응답`

> 대상 서버와 연결된 후, 해당 웹페이지를 달라고 서버에 요청
>
> 서버에서는 요청을 수락할 수 있는지 검사 후, 요청에 대한 적절한 응답을 생성해 브라우저에 전달



<br>

#### `8. 브라우저에서 응답을 해석`

> HTML, CSS, Javascript 등으로 이루어진 서버 응답 내용을
>
> 브라우저에서 해석해 그려줌



<br>

<br>

# TCP/UDP

![img](https://blog.kakaocdn.net/dn/ebbB00/btqNgswn5Ce/bbnxlGNJV48aWcN8jT7mZk/img.png)

#### TCP/UDP

> OSI 표준모델과 TCP/IP 모델의 **전송계층**에서 사용되는 프로토콜
>
> TCP
>
> - Transmission Control Protocol
> - 연결 지향 프로토콜
>
> UDP
>
> - User Datagram Protocol
> - 비연결 지향 프로토콜
>
> 
>
> 대표적인 TCP 기반 응용프로그램 : **은행**
>
> - **신뢰성**없이 속도를 우선으로 데이터를 보내게 되면 패킷의 유실이 발생할 수 있음
> - 때문에 신뢰성있는 데이터 전송을 하는 TCP 지향
> - TCP는 통신할 컴퓨터끼리 '보냄' -> '받음' 처럼 서로 확인 메세지를 보내면서 데이터를 주고받게 됨
>
> 대표적인 UDP 기반 응용프로그램 : **음악어플, 게임음성통신**, 유튜브, 
>
> - 통신 과정에서 데이터가 누락될 수 있어, 데이터 신뢰성이 중요하지 않은 곳에서 사용
> - 때문에 상호 연결 여부를 확인하지 않고 보냈으면 끝
> - 한 번에 보낼 수 있는 데이터 크기가 한계가 있어 데이터가 너무 크면 쪼개서 보내야하는게 단점















# 궁금증

`HSTS란?`

HTTPS를 클라이언트의 브라우저에서 강제화 하여 최초 접속시 부터 HTTPS로 접속 할 수 있도록 유도하기 위해 만들어졌다



이더넷 스위치 vs 라우터

스위치 : 데이터링크 계층에서 MAC 주소 테이블을 사용하여 프레임 전달

- 데이터끼리 충돌하지 않게 미리 정해놓은게 이더넷(Ethernet)
- 보통 로컬에서 사용

라우터 : 네트워크 계층에서 패킷을 목적 IP로 전달

- 보통 인터넷에서 사용

실무적으로는 같긴해

옛날에는 구분됨

스위치가 더 좋은 기능?



패킷이 뭐냐

TCP 안에 신뢰성을 패킷 안의 어떤 요소가 결정하는지

